<div>
  <main role="main">
    <app-actor-header [actor]="user$"></app-actor-header>

    <div class="mb-4">
      <div class="flex justify-end mx-2">
        <div class="flex-1 flex items-center">
          @if (isLoadingError) {
            Error loading posts <a class="btn btn-sm ml-4" (click)="loadContent()">Retry</a>
          }
          @else {
            <div class="join">
              <button *ngFor="let page of pagination" class="join-item btn btn-sm" [class.btn-active]="page.page === currentPage" (click)="loadContent(page.page)">
                {{ page.title }}
              </button>
            </div>
            <span class="ml-4 text-sm font-bold">{{ totalItems | i18nPlural : totalItemsMap }}</span>
          }
        </div>
        <button class="btn btn-primary" [disabled]="isPosting" (click)="isPosting = true" *ngIf="canPost">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
            <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m3.75 9v6m3-3H9m1.5-12H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z" />
          </svg>
          New Post
        </button>
      </div>
      <div *ngIf="isPosting" class="card bg-base-200 shadow-md mb-4">
        <div class="card-body p-2 sm:p-4">
          <div class="mb-3">
            <label for="addressee" class="block text-sm font-medium text-gray-700">Addressee</label>
            <input name="addressee" #addressee class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 mt-1 block w-full sm:text-sm border border-gray-300 rounded-md p-2" placeholder="#Public">
          </div>
          <div class="mb-3">
            <label for="content" class="block text-sm font-medium text-gray-700">Content</label>
            <textarea name="content" #postbox rows="3" class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 mt-1 w-full sm:text-sm border border-gray-300 rounded-md hidden" placeholder="Enter your message here"></textarea>
            <div class="NgxEditor__Wrapper">
              <ngx-editor-menu [editor]="editor"></ngx-editor-menu>
              <ngx-editor [editor]="editor" [(ngModel)]="html" [placeholder]="'Type here...'"></ngx-editor>
            </div>
          </div>
          <div class="card-actions justify-end">
            <button class="btn btn-outline" (click)="isPosting = false">Cancel</button>
            <button class="btn btn-primary" (click)="postMessage(addressee.value)">Post</button>
          </div>
        </div>
      </div>
    </div>

    <div>
    @if (isLoadingError) {
      <div role="alert" class="alert alert-error">
        <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
        <span>Loading failed</span>
      </div>
    }
    @else {
      <div *ngFor="let post of posts$ | async" class="mb-3">
        <app-note [post]="post" [displayAuthor]="false"></app-note>
      </div>
    }
    </div>
  </main>
</div>
